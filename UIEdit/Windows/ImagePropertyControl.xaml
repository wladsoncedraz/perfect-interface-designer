<UserControl x:Class="UIEdit.Windows.ImagePropertyControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="30" d:DesignWidth="300"
             Background="Transparent"
             x:Name="ThisControl">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="5"/>
            <ColumnDefinition Width="40"/>
            <ColumnDefinition Width="5"/>
            <ColumnDefinition Width="40"/>
        </Grid.ColumnDefinitions>
        
        <TextBox x:Name="TxtImagePath" 
                 Grid.Column="0"
                 Text="{Binding ElementName=ThisControl, Path=Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                 Background="{DynamicResource Color.SecondaryBackground}"
                 Foreground="{DynamicResource Color.Text}"
                 BorderBrush="{DynamicResource Color.Border}"
                 TextChanged="TxtImagePath_TextChanged"
                 GotFocus="TxtImagePath_GotFocus"
                 LostFocus="TxtImagePath_LostFocus"/>
        
        <Border Grid.Column="2" 
                Background="{DynamicResource Color.SecondaryBackground}"
                BorderBrush="{DynamicResource Color.Border}" 
                BorderThickness="1"
                Width="40" Height="40"
                ToolTip="{Binding ElementName=ThisControl, Path=ImageTooltip}">
            <Grid>
                <Image x:Name="ImgPreview" 
                       Stretch="Uniform"
                       Margin="2"
                       Width="36" Height="36"
                       MouseEnter="ImgPreview_MouseEnter"
                       MouseLeave="ImgPreview_MouseLeave"/>
                
                <TextBlock x:Name="TxtError" 
                           Text="?" 
                           FontSize="12"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           Foreground="Red"
                           Visibility="Collapsed"/>
            </Grid>
        </Border>
        
        <Button x:Name="BtnSelectImage" 
                Grid.Column="4"
                Width="40" Height="40"
                Background="Transparent"
                BorderBrush="{DynamicResource Color.Border}"
                BorderThickness="1"
                Click="BtnSelectImage_Click"
                ToolTip="Selecionar imagem">
            <Viewbox Margin="6">
                <Canvas Width="15" Height="15">
                    <Path Fill="{DynamicResource Color.Text}" 
                          Data="M2.5 1h10A1.5 1.5 0 0 1 14 2.5v10a1.5 1.5 0 0 1-1.5 1.5h-10A1.5 1.5 0 0 1 1 12.5v-10A1.5 1.5 0 0 1 2.5 1Zm0 1a.5.5 0 0 0-.5.5v5.864l1.682-1.682a.45.45 0 0 1 .647.01l3.545 3.798l2.808-2.808a.45.45 0 0 1 .636 0L13 9.364V2.5a.5.5 0 0 0-.5-.5h-10ZM2 12.5V9.636l1.989-1.988l3.542 3.794L8.941 13H2.5a.5.5 0 0 1-.5-.5Zm10.5.5h-2.345l-1.672-1.847L11 8.636l2 2V12.5a.5.5 0 0 1-.5.5ZM6.65 5.5a.85.85 0 1 1 1.7 0a.85.85 0 0 1-1.7 0Zm.85-1.75a1.75 1.75 0 1 0 0 3.5a1.75 1.75 0 0 0 0-3.5Z"/>
                </Canvas>
            </Viewbox>
        </Button>
        
        <Popup x:Name="ImageTooltipPopup" 
               Placement="Right" 
               PlacementTarget="{Binding ElementName=ImgPreview}"
               HorizontalOffset="10"
               VerticalOffset="-10"
               IsOpen="False"
               AllowsTransparency="True"
               PopupAnimation="Fade"
               StaysOpen="False">
            <Border Background="{DynamicResource Color.SecondaryBackground}"
                    BorderBrush="{DynamicResource Color.Border}"
                    BorderThickness="2"
                    CornerRadius="6">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <Border Grid.Row="0" 
                            Background="{DynamicResource Color.PrimaryBackground}"
                            CornerRadius="6,6,0,0"
                            Padding="8">
                        <Image x:Name="ImgTooltipPreview" 
                               MaxWidth="250" MaxHeight="180"
                               Stretch="Uniform"/>
                    </Border>
                    
                    <Border Grid.Row="1" 
                            Background="{DynamicResource Color.SecondaryBackground}"
                            CornerRadius="0,0,6,6"
                            Padding="8,6">
                        <TextBlock x:Name="TxtTooltipInfo" 
                                   FontSize="10"
                                   Foreground="{DynamicResource Color.SubText}"
                                   TextWrapping="Wrap"
                                   MaxWidth="250"/>
                    </Border>
                </Grid>
            </Border>
        </Popup>
    </Grid>
</UserControl>